<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Admin ‚Äì Benutzer√ºbersicht</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        h1, h2 {
            margin-top: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }

        form {
            display: inline-block;
            margin: 2px;
        }

        input[type="password"] {
            padding: 5px;
            font-size: 0.9rem;
            width: 150px;
        }

        button {
            padding: 5px 10px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        button.delete {
            background-color: red;
            color: white;
        }

        button.block {
            background-color: orange;
            color: white;
        }

        button.unblock {
            background-color: green;
            color: white;
        }
    </style>
</head>
<body>
    <h1>üëë Adminbereich: Benutzer√ºbersicht</h1>

    <table>
        <tr>
            <th>Benutzername</th>
            <th>Blockiert</th>
            <th>Aktionen</th>
        </tr>
        {% for name, data in users.items() %}
        <tr>
            <td>{{ name }}</td>
            <td>{{ "‚úÖ" if data.get("blocked") else "‚ùå" }}</td>
            <td>
                {% if name != "admin" %}
                    <!-- Blockieren / Freischalten -->
                    <form method="post" action="/admin/toggle-block">
                        <input type="hidden" name="username" value="{{ name }}">
                        <button class="{{ 'unblock' if data.get('blocked') else 'block' }}" type="submit">
                            {% if data.get("blocked") %}Freischalten{% else %}Blockieren{% endif %}
                        </button>
                    </form>

                    <!-- Verlauf anzeigen -->
                    <form method="get" action="/admin/history/{{ name }}">
                        <button type="submit">Verlauf</button>
                    </form>

                    <!-- Verlauf l√∂schen -->
                    <form method="post" action="/admin/delete-history">
                        <input type="hidden" name="username" value="{{ name }}">
                        <button type="submit">Verlauf l√∂schen</button>
                    </form>

                    <!-- Passwort √§ndern -->
                    <form method="post" action="/admin/change-user-password">
                        <input type="hidden" name="username" value="{{ name }}">
                        <input type="password" name="new_password" placeholder="Neues Passwort" required>
                        <button type="submit">Passwort √§ndern</button>
                    </form>

                    <!-- Benutzer l√∂schen -->
                    <form method="post" action="/admin/delete-user">
                        <input type="hidden" name="username" value="{{ name }}">
                        <button class="delete" type="submit">L√∂schen</button>
                    </form>
                {% else %}
                    <i>Admin ‚Äì keine Aktionen</i>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>

    <h2>üìÅ CSV-Export</h2>
    <form method="get" action="/admin/export-csv">
        <button type="submit">Alle Benutzer als CSV herunterladen</button>
    </form>

    <br><br>
    <a href="/chat">üîô Zur√ºck zum Chat</a> |
    <a href="/logout">üö™ Logout</a>
</body>
</html>
